<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Official Report Viewer — Barangay Santa Cruz</title>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>
<style>
/* (all your styles remain the same) */
</style>
</head>
<body>
<header>
  <div style="display:flex;gap:10px;align-items:center">
    <div class="logo">BC</div>
    <div class="stack" style="gap:2px">
      <div class="h1">Official Report Viewer</div>
      <div class="sub">Barangay Santa Cruz, Makati City</div>
    </div>
  </div>
  <button id="logoutBtn" class="tag-btn">Logout</button>
</header>

<main>
  <div class="report-selector">
    <label style="font-weight:600;display:block;margin-bottom:8px">Select Report:</label>

    <!-- ✅ NEW refresh button added -->
    <div style="display:flex;gap:8px;align-items:center">
      <select id="reportSelect" style="flex:1">
        <option value="">Choose a report...</option>
      </select>
      <button id="refreshReports" class="tag-btn" style="background:var(--amber)">Refresh</button>
    </div>
  </div>

  <!-- (everything below stays the same: reportCard, etc.) -->
  ...
</main>

<footer>Prototype only. Viewing locally saved reports. © 2025 BarangayConnect</footer>

<script src="official.js"></script>
<script>
const $ = s=>document.querySelector(s);

let reports = JSON.parse(localStorage.getItem("reports")) || [];
let currentReport = null;

const DBKEY = 'bc_exec_fw_min';
let execDB = JSON.parse(localStorage.getItem(DBKEY)||'{}');

function populateReportSelect(){
  const select = $('#reportSelect');
  select.innerHTML = '<option value="">Choose a report...</option>';

  reports = JSON.parse(localStorage.getItem("reports")) || []; // ✅ always get latest copy
  if(reports.length === 0){
    $('#noReports').style.display = 'block';
    return;
  }

  $('#noReports').style.display = 'none';

  reports.forEach((r, idx) => {
    const option = document.createElement('option');
    option.value = idx;
    option.textContent = `#${r.id} - ${r.issueType} at ${r.location} (${r.status})`;
    select.appendChild(option);
  });
}

$('#reportSelect').addEventListener('change', (e) => {
  const idx = e.target.value;
  if(idx === '') {
    $('#reportCard').style.display = 'none';
    return;
  }

  currentReport = reports[idx];
  renderReport();
  $('#reportCard').style.display = 'flex';
});

// ✅ NEW — Refresh button event
$('#refreshReports').addEventListener('click', ()=>{
  reports = JSON.parse(localStorage.getItem("reports")) || [];
  populateReportSelect();
  $('#reportCard').style.display = 'none';
  alert('Reports list refreshed!');
});

function renderReport(){ /* unchanged */ }

let lmap=null, lmarker=null;
/* rest of your functions stay unchanged (initMap, markInProgress, markResolved, etc.) */

window.addEventListener('load', () => {
  populateReportSelect();
});
</script>
</body>
</html>