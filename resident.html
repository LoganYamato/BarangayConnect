<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Resident Dashboard | BarangayConnect</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .container h2 {
      padding-top: 5%;
    }

    nav a {
      color: white;
      margin: 0 10px;
      text-decoration: none;
      font-weight: bold;
    }

    nav a:hover {
      text-decoration: underline;
    }

    .chart-section {
      margin-top: 20px;
    }

    .chart {
      background: #eaf2ff;
      border-radius: 10px;
      height: 200px;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #004aad;
      font-weight: bold;
      margin-bottom: 20px;
      text-align: center;
      flex-direction: column;
      transition: 0.3s ease;
    }

    .chart:hover {
      background: #dce9ff;
      transform: translateY(-3px);
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    @media (max-width: 600px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header class="navbar">
    <img src="logo.png" alt="Barangay Logo" class="logo">
    <h1>BarangayConnect</h1>
    <nav>
      <a href="resident.html">Dashboard</a>
      <a href="report.html">Report</a>
      <a href="official.html">Officials</a>
      <button id="logoutBtn" class="logout">Logout</button>
    </nav>
  </header>

  <main class="container">
    <h2 id="welcomeText">Welcome, Resident!</h2>

    <section class="chart-section">
      <h3>Community Statistics (Santa Cruz, Makati)</h3>
      <div class="dashboard-grid">
        <div class="chart" id="wasteChart">Waste Reports: 0</div>
        <div class="chart" id="roadChart">Road Issues: 0</div>
        <div class="chart" id="safetyChart">Safety Concerns: 0</div>
        <div class="chart" id="healthChart">Health Reports: 0</div>
      </div>
    </section>
  </main>

  <footer class="foot">
    <small>BarangayConnect â€” Resident Dashboard (Santa Cruz, Makati)</small>
  </footer>

 <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // === FIREBASE CONFIG ===
  const firebaseConfig = {
    apiKey: "AIzaSyDPrpZYIJYhAmZRxW0Ph3udw-vUz6UiPNk",
    authDomain: "iss-bc.firebaseapp.com",
    projectId: "iss-bc",
    storageBucket: "iss-bc.firebasestorage.app",
    messagingSenderId: "455122393981",
    appId: "1:455122393981:web:bdf281da744767c0064a14",
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // === AUTH CHECK ===
  const currentUser = JSON.parse(localStorage.getItem("currentUser"));
  if (!currentUser) {
    window.location.href = "index.html";
  } else if (currentUser.role !== "resident") {
    alert("Unauthorized access. Redirecting...");
    window.location.href = "index.html";
  } else {
    document.getElementById("welcomeText").textContent =
      `Welcome, ${currentUser.name || "Resident"}!`;
  }

  // === LOGOUT HANDLER ===
  document.getElementById("logoutBtn").addEventListener("click", () => {
    localStorage.removeItem("currentUser");
    window.location.href = "index.html";
  });

  // === LOAD CHART DATA FROM FIRESTORE ===
  async function loadCharts() {
    const wasteChart = document.getElementById("wasteChart");
    const roadChart = document.getElementById("roadChart");
    const safetyChart = document.getElementById("safetyChart");
    const healthChart = document.getElementById("healthChart");

    const counts = { Waste: 0, Road: 0, Safety: 0, Health: 0 };

    try {
      const snapshot = await getDocs(collection(db, "reports"));
      snapshot.forEach((doc) => {
        const r = doc.data();
        if (r.issueType && counts[r.issueType] !== undefined) {
          counts[r.issueType]++;
        }
      });

      wasteChart.textContent = `Waste Reports: ${counts.Waste}`;
      roadChart.textContent = `Road Issues: ${counts.Road}`;
      safetyChart.textContent = `Safety Concerns: ${counts.Safety}`;
      healthChart.textContent = `Health Reports: ${counts.Health}`;

      const dateNow = new Date().toLocaleDateString();
      document.querySelectorAll(".chart").forEach(chart => {
        const p = document.createElement("p");
        p.style.fontSize = "0.8em";
        p.style.color = "#555";
        p.textContent = "Updated as of " + dateNow;
        chart.appendChild(p);
      });
    } catch (err) {
      console.error("Error loading charts:", err);
      wasteChart.textContent = "Error loading data.";
      roadChart.textContent = "";
      safetyChart.textContent = "";
      healthChart.textContent = "";
    }
  }

  document.addEventListener("DOMContentLoaded", loadCharts);
</script>


  <script src="script.js"></script>
</body>
</html>



